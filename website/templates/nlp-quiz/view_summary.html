{% extends "base.html" %}

{% block title %}View Summary{% endblock %}

{% block content %}
<main class="container mt-5">
    <h2 class="h3 mb-4">Summary for {{ summary.filename }}</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="text" style="color: white;">Original Text</label>
                <textarea id="text" class="form-control" rows="20" readonly>{{ summary.text }}</textarea>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="summary" style="color: white;">Summary</label>
                <textarea id="summary" class="form-control" rows="20" readonly>{{ summary.summary }}</textarea>
            </div>
        </div>
    </div>

    <!-- Center-align buttons -->
    <div class="text-center mt-4">
        <a href="{{ url_for('views.edit_summary', summary_id=summary.id) }}" class="btn btn-warning transparent-btn mx-2" style="color: white;">Edit</a>

        <form action="{{ url_for('views.generate_quiz', summary_id=summary.id, filename=summary.filename) }}" method="POST" enctype="multipart/form-data" class="d-inline mx-2">
            {{ form.hidden_tag() }}
            <button type="submit" class="btn btn-primary transparent-btn" style="color: white;">Generate Quiz</button>
        </form>

        <button type="button" class="btn btn-danger transparent-btn mx-2" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal" style="color: white;">Delete</button>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this summary?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary transparent-btn" data-bs-dismiss="modal">Cancel</button>
                    <form action="{{ url_for('views.delete_summary', summary_id=summary.id) }}" method="POST" class="d-inline">
                        {{ form.hidden_tag() }}
                        <button type="submit" class="btn btn-danger transparent-btn">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Management (Pomodoro) Section -->
    <div class="task-container mt-5">
        <div class="pomodoro-wrapper">
            <h5>Pomodoro Study Timer</h5>
            <img src="{{ url_for('static', filename='images/pomodoro-image.png') }}" alt="Pomodoro Timer" class="pomodoro-image">
            <p id="pomodoro-message" style="font-weight: bold; color: white;" class="pomodoro-message">Put down the phone and focus!</p>
            
            <div id="timer-settings">
                <label for="timer-minutes">Minutes:</label>
                <input type="number" id="timer-minutes" value="25" min="1" max="60">
                <label for="timer-seconds">Seconds:</label>
                <input type="number" id="timer-seconds" value="0" min="0" max="59">
            </div>
            
            <div id="timer" class="pomodoro-timer">
                <span id="countdown-timer" class="countdown-display">25:00</span>
            </div>
            <div class="timer-controls mt-3">
                <button onclick="startPomodoro()" class="btn btn-info transparent-btn">Start</button>
                <button onclick="pausePomodoro()" class="btn btn-warning transparent-btn" style="color: white;">Pause</button>
                <button onclick="stopPomodoro()" class="btn btn-danger transparent-btn">Stop</button>
                <button onclick="toggleMinimize()" class="btn btn-secondary transparent-btn" id="minimize-btn">Minimize</button>
            </div>
        </div>
    </div>

    <!-- Hidden Task Section -->
    <div id="minimized-timer" class="minimized-timer" style="display: none;">
        <button onclick="toggleMinimize()" class="btn btn-secondary transparent-btn">Expand</button>
        <p id="minimized-message">Focus Time: <span id="minimized-timer-display">25:00</span></p>
    </div>

</main>

<!-- JavaScript for Pomodoro Timer -->
<script>
    let pomodoroInterval;
    let remainingTime = 25 * 60; // Default time: 25 minutes
    let isPaused = false;
    let isBreakTime = false;

    function startPomodoro() {
        if (!isPaused) {
            const minutesInput = document.getElementById('timer-minutes').value;
            const secondsInput = document.getElementById('timer-seconds').value;
            remainingTime = parseInt(minutesInput) * 60 + parseInt(secondsInput);
        }
        startCountdown();
        document.getElementById('pomodoro-message').textContent = "Put down the phone and focus!";
        isPaused = false;
    }

    function startCountdown() {
        pomodoroInterval = setInterval(function() {
            const min = Math.floor(remainingTime / 60);
            const sec = remainingTime % 60;
            document.getElementById('countdown-timer').textContent =
                `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            document.getElementById('minimized-timer-display').textContent =
                `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            remainingTime--;

            if (remainingTime < 0) {
                clearInterval(pomodoroInterval);
                document.getElementById('countdown-timer').classList.add('timer-finished');
                document.getElementById('minimized-timer-display').classList.add('timer-finished');
                document.getElementById('pomodoro-message').textContent = "Time's up! Take a break!";
                
                if (isBreakTime) {
                    alert("Break time over! Back to work!");
                    isBreakTime = false;
                    startPomodoro();
                } else {
                    alert("Time's up! Take a 5-minute break.");
                    isBreakTime = true;
                    startPomodoro(); // Automatically start break time
                }
            }
        }, 1000);
    }

    function pausePomodoro() {
        clearInterval(pomodoroInterval);
        isPaused = true;
    }

    function stopPomodoro() {
        clearInterval(pomodoroInterval);
        remainingTime = 25 * 60; // Reset to 25 minutes
        document.getElementById('countdown-timer').textContent = "25:00";
        document.getElementById('minimized-timer-display').textContent = "25:00";
        isPaused = false;
        isBreakTime = false;
    }

    function toggleMinimize() {
        const timer = document.querySelector('.pomodoro-wrapper');
        const minimized = document.querySelector('.minimized-timer');
        if (timer.style.display === "none") {
            timer.style.display = "block";
            minimized.style.display = "none";
        } else {
            timer.style.display = "none";
            minimized.style.display = "block";
        }
    }
</script>

{% endblock %}
